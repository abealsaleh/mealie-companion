<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#ef6c00">
  <link rel="manifest" href="/manifest.json">
  <title>Mealie Companion</title>
  <script src="https://unpkg.com/lucide@0.468.0/dist/umd/lucide.min.js"></script>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

<header>
  <div class="header-bar">
    <span class="app-title">Mealie Companion</span>
    <div class="header-actions">
      <a class="header-action-btn" href="https://github.com/abealsaleh/mealie-companion/issues/new" target="_blank" rel="noopener" title="Report issue"><i data-lucide="bug" class="icon"></i></a>
      <button class="header-action-btn" onclick="logout()" title="Sign out"><i data-lucide="log-out" class="icon"></i></button>
    </div>
  </div>
  <nav>
    <button class="active" onclick="switchTab('mealplan')"><i data-lucide="calendar-plus" class="icon"></i> Meal Plan</button>
    <button onclick="switchTab('shopping')"><i data-lucide="shopping-cart" class="icon"></i> Shopping</button>
  </nav>
</header>

<!-- Login screen -->
<div id="setup">
  <form id="login-form" action="#" method="post" onsubmit="event.preventDefault();doLogin()">
    <div style="font-size:48px;margin-bottom:8px;text-align:center"><i data-lucide="chef-hat" style="width:48px;height:48px;color:var(--accent)"></i></div>
    <h2 style="text-align:center">Sign In</h2>
    <p style="color:var(--text-muted);text-align:center;font-size:14px;max-width:340px;margin:0 auto 16px">Log in with your Mealie account.</p>
    <input type="text" id="login-email" name="username" placeholder="Email or username" autocomplete="username">
    <input type="password" id="login-password" name="password" placeholder="Password" autocomplete="current-password">
    <label style="display:flex;align-items:center;gap:8px;color:var(--text-muted);font-size:14px;width:100%;max-width:400px">
      <input type="checkbox" id="login-remember" name="remember" checked> Remember me
    </label>
    <button type="submit" class="btn btn-primary" id="login-btn">Sign In</button>
    <div id="login-error" style="color:var(--accent);font-size:14px;display:none"></div>
    <button type="button" class="btn btn-outline btn-sm" onclick="hideSetup()" style="margin-top:8px">Cancel</button>
  </form>
</div>

<!-- Meal Plan Tab -->
<div id="mealplan-tab" class="tab active">
  <div class="mp-range-header">
    <span id="mp-range-label" style="flex:1;text-align:center">Next 8 Days</span>
    <button class="btn btn-outline btn-sm" onclick="loadMealPlan()" style="display:flex;align-items:center;padding:6px"><i data-lucide="refresh-cw" style="width:14px;height:14px"></i></button>
  </div>
  <div class="mp-plan-scroll">
    <div id="mp-plan-content">
      <div class="loading-bar visible"><span class="spinner"></span> Loading meal plan...</div>
    </div>
  </div>
  <button class="fab" onclick="toggleAddPanel('mealplan')" id="mp-fab"><i data-lucide="plus" style="width:24px;height:24px"></i></button>
  <div class="add-modal-overlay" id="mp-add-modal" onclick="if(event.target===this)closeAddPanel('mealplan')">
    <div class="add-modal">
      <div class="add-modal-header">
        <span>Add to Meal Plan</span>
        <button onclick="closeAddPanel('mealplan')"><i data-lucide="x" style="width:18px;height:18px"></i></button>
      </div>
      <div class="form-group">
        <label><i data-lucide="search" style="width:14px;height:14px;vertical-align:-2px"></i> Recipe name or URL</label>
        <input type="text" id="mp-input" placeholder="Paste URL or type recipe name..." autocomplete="off">
      </div>
      <div class="input-hint">Paste a URL to import, or type to search existing recipes</div>
      <div id="mp-search-results" class="search-results" style="display:none"></div>
      <div class="form-row">
        <div class="form-group">
          <label>Date</label>
          <select id="mp-date"></select>
        </div>
        <div class="form-group">
          <label>Meal</label>
          <select id="mp-meal">
            <option value="breakfast">Breakfast</option>
            <option value="lunch">Lunch</option>
            <option value="dinner" selected>Dinner</option>
            <option value="side">Side</option>
            <option value="snack">Snack</option>
            <option value="dessert">Dessert</option>
            <option value="drink">Drink</option>
          </select>
        </div>
      </div>
      <div style="padding: 0 16px 16px">
        <button class="btn btn-primary" style="width:100%;display:flex;align-items:center;justify-content:center;gap:8px" id="mp-submit" onclick="submitMealPlan()">
          <i data-lucide="plus" class="icon"></i> Add to Meal Plan
        </button>
      </div>
      <div id="mp-loading" class="loading-bar">
        <span class="spinner"></span> Working...
      </div>
      <div id="mp-results"></div>
    </div>
  </div>
</div>

<!-- Shopping Tab -->
<div id="shopping-tab" class="tab">
  <div class="list-header">
    <select id="list-selector" onchange="selectList(this.value)">
      <option value="">Loading lists...</option>
    </select>
    <button class="btn btn-outline btn-sm" onclick="refreshList()" style="display:flex;align-items:center;padding:8px"><i data-lucide="refresh-cw" style="width:16px;height:16px"></i></button>
  </div>
  <div class="shopping-scroll" id="shopping-scroll">
    <div class="pull-indicator" id="pull-indicator">â†“ Pull to refresh</div>
    <div id="shopping-content">
      <div class="empty-state">Select a shopping list to get started</div>
    </div>
  </div>
  <button class="fab" onclick="toggleAddPanel('shopping')" id="shop-fab"><i data-lucide="plus" style="width:24px;height:24px"></i></button>
  <div class="add-modal-overlay" id="shop-add-modal" onclick="if(event.target===this)closeAddPanel('shopping')">
    <div class="add-modal">
      <div class="add-modal-header">
        <span>Add Item</span>
        <button onclick="closeAddPanel('shopping')"><i data-lucide="x" style="width:18px;height:18px"></i></button>
      </div>
      <div class="add-modal-body">
        <div class="add-modal-input-row">
          <input type="text" id="add-item-input" placeholder="Add an item..." autocomplete="off"
                 oninput="onAddItemInput()" onfocus="onAddItemInput()">
          <button class="btn btn-primary btn-sm" id="add-item-btn" onclick="addItemFromInput()" style="display:flex;align-items:center;gap:4px"><i data-lucide="plus" style="width:16px;height:16px" id="add-item-icon"></i> <span id="add-item-label">Add</span></button>
        </div>
        <div class="autocomplete-dropdown" id="autocomplete-dropdown"></div>
        <div class="category-select-bar" id="category-select-bar">
          <span>Category:</span>
          <select id="category-override">
            <option value="">Auto</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="label-modal-overlay" id="label-modal" onclick="if(event.target===this)closeLabelModal()">
  <div class="label-modal">
    <div class="label-modal-header">
      <span id="label-modal-title">Change Category</span>
      <button onclick="closeLabelModal()"><i data-lucide="x" style="width:18px;height:18px"></i></button>
    </div>
    <div class="label-modal-search">
      <input type="text" id="label-search-input" placeholder="Search categories..." oninput="filterLabelModal()" autocomplete="off">
    </div>
    <div class="label-modal-list" id="label-modal-list"></div>
  </div>
</div>

<div class="note-modal-overlay" id="note-modal" onclick="if(event.target===this)closeNoteModal()">
  <div class="note-modal">
    <div class="note-modal-header">
      <span id="note-modal-title">Edit Note</span>
      <button onclick="closeNoteModal()"><i data-lucide="x" style="width:18px;height:18px"></i></button>
    </div>
    <textarea id="note-modal-input" placeholder="Add a note..."></textarea>
    <button class="btn btn-primary" onclick="saveNote()" style="display:flex;align-items:center;justify-content:center;gap:8px">
      <i data-lucide="check" class="icon"></i> Save
    </button>
  </div>
</div>

<div class="label-modal-overlay" id="list-picker-modal" onclick="if(event.target===this)closeListPicker()">
  <div class="label-modal">
    <div class="label-modal-header">
      <span>Add ingredients to...</span>
      <button onclick="closeListPicker()"><i data-lucide="x" style="width:18px;height:18px"></i></button>
    </div>
    <div class="label-modal-list" id="list-picker-options"></div>
  </div>
</div>

<div class="label-modal-overlay" id="ingredient-modal" onclick="if(event.target===this)closeIngredientModal()">
  <div class="label-modal ingredient-modal">
    <div class="label-modal-header">
      <span id="ingredient-modal-title">Ingredients</span>
      <button onclick="closeIngredientModal()"><i data-lucide="x" style="width:18px;height:18px"></i></button>
    </div>
    <div class="ingredient-list" id="ingredient-list"></div>
    <div class="ingredient-modal-footer" id="ingredient-modal-footer">
      <button class="btn btn-primary" id="ingredient-add-btn" style="width:100%;display:flex;align-items:center;justify-content:center;gap:8px">
        <i data-lucide="shopping-cart" class="icon"></i> Add items to Shopping List
      </button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="/app.js"></script>
</body>
</html>
